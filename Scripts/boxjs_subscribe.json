// @name         油价数据配置
// @author       YourName
// @description  油价数据存储和配置
// @version      1.0.0
// @supported    ios15-ios17

const $ = new ENV("油价数据:1.0.0");

// 省份映射表
const PROVINCE_MAP = {
  "11": "北京", "12": "天津", "13": "河北", "14": "山西", "15": "内蒙古",
  "21": "辽宁", "22": "吉林", "23": "黑龙江", "31": "上海", "32": "江苏",
  "33": "浙江", "34": "安徽", "35": "福建", "36": "江西", "37": "山东",
  "41": "河南", "42": "湖北", "43": "湖南", "44": "广东", "45": "广西",
  "46": "海南", "50": "重庆", "51": "四川", "52": "贵州", "53": "云南",
  "54": "西藏", "61": "陕西", "62": "甘肃", "63": "青海", "64": "宁夏", "65": "新疆"
};

// 反转映射表（名称到ID）
const REVERSE_PROVINCE_MAP = {};
Object.keys(PROVINCE_MAP).forEach(id => {
  REVERSE_PROVINCE_MAP[PROVINCE_MAP[id]] = id;
});

// 配置定义
$.config = {
  oil_province: {
    title: "选择省份",
    type: "select",
    options: Object.values(PROVINCE_MAP),
    default: "上海",
    value: null
  },
  
  oil_price_data: {
    title: "油价数据",
    type: "json",
    readonly: true,
    value: null
  },
  
  refresh_interval: {
    title: "刷新频率(小时)",
    type: "number",
    default: 4,
    min: 1,
    max: 24,
    value: null
  }
};

// 数据导出
$.export = () => {
  Object.keys($.config).forEach(key => {
    $.data[key] = $.config[key].value;
  });
  return $.data;
};

// 设置默认值
$.defaults = () => {
  Object.keys($.config).forEach(key => {
    if ($.config[key].default !== undefined) {
      $.data[key] = $.config[key].default;
    }
  });
};

// 初始化
$.init = () => {
  $.defaults();
  $.export();
};

// 获取省份ID（供Quantumult X使用）
$.getProvinceId = () => {
  const provinceName = $.read("oil_province") || "上海";
  return REVERSE_PROVINCE_MAP[provinceName] || "31"; // 默认上海
};

$.init();
